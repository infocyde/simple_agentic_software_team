<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Night Ronin's Agentic Software Team</title>
    <link rel="icon" href="/static/favicon.png" type="image/png">
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div id="splashOverlay" class="splash-overlay" style="display: none;">
        <div class="splash-backdrop"></div>
        <div class="splash-content">
            <img src="/static/night-ronin.png" alt="NightRonin" class="splash-logo">
        </div>
    </div>
    <div class="container">
        <header>
            <h1><img src="/static/ninja.gif" alt="Ninja" style="height: 2em; vertical-align: middle; margin-right: 0.3em;">Night Ronin's Agentic Software Team</h1>
            <p class="subtitle">AI agents building software together</p>
        </header>

        <div class="main-layout">
            <!-- Left Panel: Projects -->
            <aside class="projects-panel">
                <div class="panel-header">
                    <h2>Projects</h2>
                    <button id="newProjectBtn" class="btn btn-primary">+ New</button>
                </div>
                <ul id="projectList" class="project-list">
                    {% for project in projects %}
                    <li class="project-item" data-name="{{ project.name }}" data-status="{{ project.workflow_status | default('initialized') }}">
                        <span class="project-name">{{ project.name }}</span>
                        <span class="project-status">
                            {% if project.workflow_status == 'done' %}
                            <span class="badge badge-done">Done</span>
                            {% elif project.workflow_status == 'uat' %}
                            <span class="badge badge-uat">UAT</span>
                            {% elif project.workflow_status == 'qa' %}
                            <span class="badge badge-qa">QA</span>
                            {% elif project.workflow_status == 'security_review' %}
                            <span class="badge badge-security">Security</span>
                            {% elif project.workflow_status == 'wip' %}
                            <span class="badge badge-wip">WIP {{ project.todo_completed }}/{{ project.todo_total }}</span>
                            {% elif project.todo_total > 0 %}
                            <span class="badge badge-progress">{{ project.todo_completed }}/{{ project.todo_total }}</span>
                            {% else %}
                            <span class="badge badge-new">New</span>
                            {% endif %}
                        </span>
                    </li>
                    {% endfor %}
                </ul>
            </aside>

            <!-- Center Panel: Main Content -->
            <main class="main-panel">
                <!-- Global Activity Indicator -->
                <div id="activityIndicator" class="activity-indicator" style="display: none;">
                    <div class="activity-pulse"></div>
                    <span id="activityText">Working...</span>
                    <span id="activityAgents" class="activity-agents"></span>
                </div>
                <div id="noProjectSelected" class="empty-state">
                    <h3>Select a project or create a new one</h3>
                    <p>Projects appear in the left panel. Click on one to view details.</p>
                </div>

                <div id="projectView" class="project-view" style="display: none;">
                    <div class="project-header">
                        <div class="project-title-row">
                            <h2 id="projectTitle">Project Name</h2>
                            <div id="projectStatusBadge" class="project-status-badge">
                                <span class="status-label">Status:</span>
                                <span id="projectStatusValue" class="status-value badge badge-new">Initialized</span>
                            </div>
                        </div>
                        <div class="project-status-timeline" id="projectStatusTimeline">
                            <div class="status-step" data-status="initialized">
                                <span class="step-dot"></span>
                                <span class="step-label">Init</span>
                            </div>
                            <div class="status-step" data-status="wip">
                                <span class="step-dot"></span>
                                <span class="step-label">WIP</span>
                            </div>
                            <div class="status-step" data-status="testing">
                                <span class="step-dot"></span>
                                <span class="step-label">Testing</span>
                            </div>
                            <div class="status-step" data-status="security_review">
                                <span class="step-dot"></span>
                                <span class="step-label">Security</span>
                            </div>
                            <div class="status-step" data-status="qa">
                                <span class="step-dot"></span>
                                <span class="step-label">QA</span>
                            </div>
                            <div class="status-step" data-status="uat">
                                <span class="step-dot"></span>
                                <span class="step-label">UAT</span>
                            </div>
                            <div class="status-step" data-status="done">
                                <span class="step-dot"></span>
                                <span class="step-label">Done</span>
                            </div>
                        </div>
                        <div class="project-actions">
                            <button id="kickoffBtn" class="btn btn-primary">Start Kickoff</button>
                            <button id="featureBtn" class="btn btn-secondary">Add Feature</button>
                            <button id="startWorkBtn" class="btn btn-secondary">Start Work</button>
                            <button id="pauseBtn" class="btn btn-secondary" style="display: none;">Pause</button>
                            <button id="forceStopBtn" class="btn btn-danger" style="display: none;">Force Stop</button>
                            <button id="changeStatusBtn" class="btn btn-secondary">Change Status</button>
                            <button id="startUatBtn" class="btn btn-uat" style="display: none;">Start UAT</button>
                            <button id="completeUatBtn" class="btn btn-success" style="display: none;">Complete UAT</button>
                            <button id="launchProjectBtn" class="btn btn-launch">Launch</button>
                            <button id="stopLaunchBtn" class="btn btn-danger">Stop</button>
                            <button id="launchLogBtn" class="btn btn-secondary btn-small">Launch Log</button>
                        </div>
                        <div id="runitWarning" class="runit-warning" style="display: none;">
                            Launch needs a clear run command in <code>runit.md</code>. Please update it and try again.
                        </div>
                        <div id="qaRunHint" class="qa-run-hint" style="display: none;">
                            <div class="qa-run-title">QA Prep: Test It Yourself First</div>
                            <div class="qa-run-text">Use the run instructions in <code>runit.md</code> to test the project before QA review chat.</div>
                            <button id="openRunitBtn" class="btn btn-secondary btn-small">Open runit.md</button>
                        </div>
                    </div>

                    <div class="quality-gates" id="qualityGates">
                        <label class="gate-toggle">
                            <input type="checkbox" id="gateSecurity" checked>
                            <span>Security Review</span>
                        </label>
                        <label class="gate-toggle">
                            <input type="checkbox" id="gateQa" checked>
                            <span>QA Review</span>
                        </label>
                        <label class="gate-toggle">
                            <input type="checkbox" id="gateTests" checked>
                            <span>Run Tests</span>
                        </label>
                        <button id="saveGatesBtn" class="btn btn-secondary btn-small">Save Gates</button>
                        <span id="gatesStatus" class="gates-status"></span>
                        <label class="gate-toggle" style="margin-left: 16px;">
                            <input type="checkbox" id="debugToggle">
                            <span>Debug Mode</span>
                        </label>
                    </div>

                    <div class="tabs">
                        <button class="tab" data-tab="chat">Chat</button>
                        <button class="tab active" data-tab="activity">Activity</button>
                        <button class="tab" data-tab="spec">Spec</button>
                        <button class="tab" data-tab="todo">TODO</button>
                        <button class="tab" data-tab="log">Log</button>
                        <button class="tab" data-tab="debug" id="debugTabBtn" style="display: none;">Debug</button>
                    </div>

                    <div class="tab-content">
                        <!-- Chat Tab - For Q&A with agents -->
                        <div id="chatTab" class="tab-pane" style="display: none;">
                            <div class="chat-container">
                                <div id="chatMessages" class="chat-messages">
                                    <p class="empty-message">Start a kickoff or add a feature to begin chatting with the team.</p>
                                </div>
                                <div class="chat-input-area">
                                <div id="chatStatus" class="chat-status"></div>
                                <form id="chatForm" class="chat-form">
                                    <textarea id="chatInput" rows="2" placeholder="Type your response..." disabled></textarea>
                                    <button type="submit" class="btn btn-primary" id="chatSendBtn" disabled>Send</button>
                                    <button type="button" class="btn btn-secondary" id="writeSpecBtn" style="display: none;">Write Spec</button>
                                </form>
                                <div id="uatHelper" class="chat-helper" style="display: none;">
                                    <span><strong>Update Reqs</strong> updates SPEC/TODO and resumes work. <strong>Done</strong> generates runit.md and marks the project Done.</span>
                                </div>
                            </div>
                        </div>
                        </div>

                        <div id="activityTab" class="tab-pane active">
                            <div id="activityFeed" class="activity-feed">
                                <p class="empty-message">No activity yet. Start a kickoff or continue work.</p>
                            </div>
                        </div>
                        <div id="specTab" class="tab-pane" style="display: none;">
                            <pre id="specContent" class="content-display"></pre>
                        </div>
                        <div id="todoTab" class="tab-pane" style="display: none;">
                            <pre id="todoContent" class="content-display"></pre>
                        </div>
                        <div id="logTab" class="tab-pane" style="display: none;">
                            <pre id="logContent" class="content-display"></pre>
                        </div>
                        <div id="debugTab" class="tab-pane" style="display: none;">
                            <div id="debugOutput" style="font-family: monospace; font-size: 12px; max-height: 600px; overflow-y: auto; background: #1a1a2e; color: #0f0; padding: 10px; border-radius: 4px; white-space: pre-wrap; word-wrap: break-word;">
                                <p style="color: #666;">Debug mode streams real-time output from agents. Enable debug mode and start work to see output here.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </main>

            <!-- Right Panel: Agent Status -->
            <aside class="agents-panel">
                <h2>Team Status</h2>
                <div class="agent-list">
                    <div class="agent-item" data-agent="project_manager">
                        <span class="agent-icon">üìã</span>
                        <span class="agent-name">Project Manager</span>
                        <span class="agent-status idle">Idle</span>
                    </div>
                    <div class="agent-item" data-agent="software_engineer">
                        <span class="agent-icon">üíª</span>
                        <span class="agent-name">Software Engineer</span>
                        <span class="agent-status idle">Idle</span>
                    </div>
                    <div class="agent-item" data-agent="ui_ux_engineer">
                        <span class="agent-icon">üé®</span>
                        <span class="agent-name">UI/UX Engineer</span>
                        <span class="agent-status idle">Idle</span>
                    </div>
                    <div class="agent-item" data-agent="database_admin">
                        <span class="agent-icon">üóÑÔ∏è</span>
                        <span class="agent-name">Database Admin</span>
                        <span class="agent-status idle">Idle</span>
                    </div>
                    <div class="agent-item" data-agent="security_reviewer">
                        <span class="agent-icon">üîí</span>
                        <span class="agent-name">Security Reviewer</span>
                        <span class="agent-status idle">Idle</span>
                    </div>
                    <div class="agent-item" data-agent="testing_agent">
                        <span class="agent-icon">üß™</span>
                        <span class="agent-name">Testing Agent</span>
                        <span class="agent-status idle">Idle</span>
                    </div>
                    <div class="agent-item" data-agent="qa_tester">
                        <span class="agent-icon">üß™</span>
                        <span class="agent-name">QA Tester</span>
                        <span class="agent-status idle">Idle</span>
                    </div>
                </div>
            </aside>
        </div>
    </div>

    <!-- Modals -->
    <div id="modalOverlay" class="modal-overlay" style="display: none;">
        <div id="newProjectModal" class="modal" style="display: none;">
            <h3>Create New Project</h3>
            <form id="newProjectForm">
                <div class="form-group">
                    <label for="projectName">Project Name</label>
                    <input type="text" id="projectName" required placeholder="my-awesome-project">
                </div>
                <div class="form-group">
                    <label class="checkbox-row">
                        <input type="checkbox" id="fastProject">
                        <span>Fast Project (skip testing, security, and QA by default)</span>
                    </label>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" id="cancelNewProject">Cancel</button>
                    <button type="submit" class="btn btn-primary">Create</button>
                </div>
            </form>
        </div>

        <div id="messageModal" class="modal" style="display: none;">
            <h3 id="messageModalTitle">Send Message</h3>
            <form id="messageForm">
                <div class="form-group">
                    <textarea id="messageInput" rows="4" required placeholder="Describe what you want to build..."></textarea>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" id="cancelMessage">Cancel</button>
                    <button type="submit" class="btn btn-primary">Start</button>
                </div>
            </form>
        </div>

        <div id="errorModal" class="modal error-modal" style="display: none;">
            <h3 class="error-title">Error</h3>
            <div id="errorMessage" class="error-message"></div>
            <div class="modal-actions">
                <button type="button" class="btn btn-primary" id="dismissError">Dismiss</button>
            </div>
        </div>

        <div id="changeStatusModal" class="modal" style="display: none;">
            <h3>Change Project Status</h3>
            <form id="changeStatusForm">
                <div class="form-group">
                    <label for="projectStatusSelect">New Status</label>
                    <select id="projectStatusSelect" required>
                        <option value="initialized">Initialized</option>
                        <option value="wip">Work In Progress</option>
                        <option value="testing">Testing</option>
                        <option value="security_review">Security Review</option>
                        <option value="qa">QA Testing</option>
                        <option value="uat">User Acceptance Testing</option>
                        <option value="done">Done</option>
                    </select>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" id="cancelChangeStatus">Cancel</button>
                <button type="submit" class="btn btn-primary" id="confirmChangeStatus">Change Status</button>
            </div>
        </form>
    </div>

        <div id="runitModal" class="modal" style="display: none;">
            <h3>Run Instructions (runit.md)</h3>
            <pre id="runitContent" class="content-display"></pre>
            <div class="modal-actions">
                <button type="button" class="btn btn-secondary" id="closeRunitModal">Close</button>
            </div>
        </div>
        <div id="launchLogModal" class="modal" style="display: none;">
            <h3>Launch Log</h3>
            <pre id="launchLogContent" class="content-display"></pre>
            <div class="modal-actions">
                <button type="button" class="btn btn-secondary" id="closeLaunchLogModal">Close</button>
            </div>
        </div>
    </div>

    <script src="/static/app.js"></script>
</body>
</html>
